{"version":3,"file":"analytics.js","sources":["../node_modules/web-vitals/dist/web-vitals.js","../tag/analytics.ts"],"sourcesContent":["var t,e,n,i,a=function(t,e){return{name:t,value:void 0===e?-1:0,delta:0,entries:[],id:\"v1-\".concat(Date.now(),\"-\").concat(Math.floor(8999999999999*Math.random())+1e12)}},r=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){var n=new PerformanceObserver((function(t){return t.getEntries().map(e)}));return n.observe({type:t,buffered:!0}),n}}catch(t){}},o=!1,u=function(t,e){o||\"undefined\"!=typeof InstallTrigger||(addEventListener(\"beforeunload\",(function(){})),o=!0);addEventListener(\"visibilitychange\",(function n(i){\"hidden\"===document.visibilityState&&(t(i),e&&removeEventListener(\"visibilitychange\",n,!0))}),!0)},c=function(t){addEventListener(\"pageshow\",(function(e){e.persisted&&t(e)}),!0)},s=new WeakSet,f=function(t,e,n){var i;return function(){e.value>=0&&(n||s.has(e)||\"hidden\"===document.visibilityState)&&(e.delta=e.value-(i||0),(e.delta||void 0===i)&&(i=e.value,t(e)))}},m=function(t,e){var n,i=a(\"CLS\",0),o=function(t){t.hadRecentInput||(i.value+=t.value,i.entries.push(t),n())},s=r(\"layout-shift\",o);s&&(n=f(t,i,e),u((function(){s.takeRecords().map(o),n()})),c((function(){i=a(\"CLS\",0),n=f(t,i,e)})))},d=-1,p=function(){return\"hidden\"===document.visibilityState?0:1/0},v=function(){u((function(t){var e=t.timeStamp;d=e}),!0)},l=function(){return d<0&&(d=p(),v(),c((function(){setTimeout((function(){d=p(),v()}),0)}))),{get timeStamp(){return d}}},S=function(t,e){var n,i=l(),o=a(\"FCP\"),u=r(\"paint\",(function(t){\"first-contentful-paint\"===t.name&&(u&&u.disconnect(),t.startTime<i.timeStamp&&(o.value=t.startTime,o.entries.push(t),s.add(o),n()))}));u&&(n=f(t,o,e),c((function(i){o=a(\"FCP\"),n=f(t,o,e),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,s.add(o),n()}))}))})))},y={passive:!0,capture:!0},h=new Date,g=function(i,a){t||(t=a,e=i,n=new Date,T(removeEventListener),w())},w=function(){if(e>=0&&e<n-h){var a={entryType:\"first-input\",name:t.type,target:t.target,cancelable:t.cancelable,startTime:t.timeStamp,processingStart:t.timeStamp+e};i.map((function(t){t(a)})),i=[]}},L=function(t){if(t.cancelable){var e=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;\"pointerdown\"==t.type?function(t,e){var n=function(){g(t,e),a()},i=function(){a()},a=function(){removeEventListener(\"pointerup\",n,y),removeEventListener(\"pointercancel\",i,y)};addEventListener(\"pointerup\",n,y),addEventListener(\"pointercancel\",i,y)}(e,t):g(e,t)}},T=function(t){[\"mousedown\",\"keydown\",\"touchstart\",\"pointerdown\"].map((function(e){return t(e,L,y)}))},E=function(n,o){var m,d=l(),p=a(\"FID\"),v=function(t){t.startTime<d.timeStamp&&(p.value=t.processingStart-t.startTime,p.entries.push(t),s.add(p),m())},S=r(\"first-input\",v);m=f(n,p,o),S&&u((function(){S.takeRecords().map(v),S.disconnect()}),!0),S&&c((function(){var r;p=a(\"FID\"),m=f(n,p,o),i=[],e=-1,t=null,T(addEventListener),r=v,i.push(r),w()}))},b=function(t,e){var n,i=l(),o=a(\"LCP\"),m=function(t){var e=t.startTime;e<i.timeStamp&&(o.value=e,o.entries.push(t)),n()},d=r(\"largest-contentful-paint\",m);if(d){n=f(t,o,e);var p=function(){s.has(o)||(d.takeRecords().map(m),d.disconnect(),s.add(o),n())};[\"keydown\",\"click\"].map((function(t){addEventListener(t,p,{once:!0,capture:!0})})),u(p,!0),c((function(i){o=a(\"LCP\"),n=f(t,o,e),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,s.add(o),n()}))}))}))}},F=function(t){var e,n=a(\"TTFB\");e=function(){try{var e=performance.getEntriesByType(\"navigation\")[0]||function(){var t=performance.timing,e={entryType:\"navigation\",startTime:0};for(var n in t)\"navigationStart\"!==n&&\"toJSON\"!==n&&(e[n]=Math.max(t[n]-t.navigationStart,0));return e}();n.value=n.delta=e.responseStart,n.entries=[e],t(n)}catch(t){}},\"complete\"===document.readyState?setTimeout(e,0):addEventListener(\"pageshow\",e)};export{m as getCLS,S as getFCP,E as getFID,b as getLCP,F as getTTFB};\n","import * as webVitals from 'web-vitals';\nimport { SerializedData, Metric } from '../src/types';\nconst origin = process.env.SCRIPT_ORIGIN;\nconst script = window.document.querySelector(\n  `script[src=\"${origin}/analytics.js\"]`\n);\n\ninterface MetricMap {\n  [id: string]: Metric;\n}\n\nconst property = script!.getAttribute('data-property')!;\nconst url = window.location.href;\nconst sessionStartTime = Date.now();\nconst metricMap: MetricMap = {};\nlet dataSent = false;\n\nfunction reportMetric(metric: webVitals.Metric) {\n  metricMap[metric.id] = {\n    id: metric.id,\n    name: metric.name,\n    value: metric.value,\n  };\n}\n\nfunction sendData() {\n  if (dataSent) return;\n  dataSent = true;\n  const data: SerializedData = {\n    property,\n    metrics: Object.values(metricMap),\n    url,\n    duration: Date.now() - sessionStartTime,\n  };\n  const collectUrl = `${origin}/api/collect/${property}`;\n  const serializedData = JSON.stringify(data);\n  if (navigator.sendBeacon) {\n    return navigator.sendBeacon(collectUrl, serializedData);\n  } else {\n    var xhr = new XMLHttpRequest();\n    xhr.open('POST', collectUrl);\n    xhr.send(serializedData);\n  }\n}\n\nwebVitals.getCLS(reportMetric, true);\nwebVitals.getFCP(reportMetric, true);\nwebVitals.getFID(reportMetric, true);\nwebVitals.getLCP(reportMetric, true);\nwebVitals.getTTFB(reportMetric);\n\nwindow.addEventListener('pagehide', sendData);\n\n// function pageView() {\n//   sendBeacon({\n//     property: property,\n//     name: 'pageview',\n//     referrer: window.document.referrer,\n//     url: window.location.href,\n//   });\n// }\n//\n// pageView();\n//\n// if (window.history) {\n//   const originalPushState = window.history.pushState;\n//   window.history.pushState = function () {\n//     originalPushState.apply(\n//       this,\n//       (arguments as unknown) as Parameters<typeof window.history.pushState>\n//     );\n//     pageView();\n//   };\n// }\n"],"names":["t","e","n","i","a","name","value","delta","entries","id","concat","Date","now","Math","floor","random","r","PerformanceObserver","supportedEntryTypes","includes","getEntries","map","observe","type","buffered","o","u","InstallTrigger","addEventListener","document","visibilityState","removeEventListener","c","persisted","s","WeakSet","f","has","d","p","v","timeStamp","l","setTimeout","y","passive","capture","h","g","T","w","entryType","target","cancelable","startTime","processingStart","L","performance","origin","process","property","window","querySelector","getAttribute","url","location","href","sessionStartTime","metricMap","dataSent","reportMetric","metric","hadRecentInput","push","takeRecords","disconnect","add","requestAnimationFrame","m","S","once","getEntriesByType","timing","max","navigationStart","responseStart","readyState","data","metrics","Object","values","duration","collectUrl","serializedData","JSON","stringify","navigator","sendBeacon","xhr","XMLHttpRequest","open","send"],"mappings":"yBAAA,IAAIA,EAAEC,EAAEC,EAAEC,EAAEC,EAAE,SAASJ,EAAEC,GAAG,MAAM,CAACI,KAAKL,EAAEM,WAAM,IAASL,GAAG,EAAE,EAAEM,MAAM,EAAEC,QAAQ,GAAGC,GAAG,MAAMC,OAAOC,KAAKC,MAAM,KAAKF,OAAOG,KAAKC,MAAM,cAAcD,KAAKE,UAAU,QAAQC,EAAE,SAAShB,EAAEC,GAAG,IAAI,GAAGgB,oBAAoBC,oBAAoBC,SAASnB,GAAG,CAAC,IAAIE,EAAE,IAAIe,8BAA8BjB,GAAG,OAAOA,EAAEoB,aAAaC,IAAIpB,MAAM,OAAOC,EAAEoB,QAAQ,CAACC,KAAKvB,EAAEwB,UAAS,IAAKtB,GAAG,MAAMF,MAAMyB,GAAE,EAAGC,EAAE,SAAS1B,EAAEC,GAAGwB,GAAG,oBAAoBE,iBAAiBC,iBAAiB,+BAA+BH,GAAE,GAAIG,iBAAiB,6BAA6B1B,EAAEC,GAAG,WAAW0B,SAASC,kBAAkB9B,EAAEG,GAAGF,GAAG8B,oBAAoB,mBAAmB7B,GAAE,OAAO,IAAK8B,EAAE,SAAShC,GAAG4B,iBAAiB,qBAAqB3B,GAAGA,EAAEgC,WAAWjC,EAAEC,MAAK,IAAKiC,EAAE,IAAIC,QAAQC,EAAE,SAASpC,EAAEC,EAAEC,GAAG,IAAIC,EAAE,OAAO,WAAWF,EAAEK,OAAO,IAAIJ,GAAGgC,EAAEG,IAAIpC,IAAI,WAAW4B,SAASC,mBAAmB7B,EAAEM,MAAMN,EAAEK,OAAOH,GAAG,IAAIF,EAAEM,YAAO,IAASJ,KAAKA,EAAEF,EAAEK,MAAMN,EAAEC,OAAgPqC,GAAG,EAAEC,EAAE,WAAW,MAAM,WAAWV,SAASC,gBAAgB,EAAE,EAAA,GAAKU,EAAE,WAAWd,YAAY1B,GAAG,IAAIC,EAAED,EAAEyC,UAAUH,EAAErC,KAAI,IAAKyC,EAAE,WAAW,OAAOJ,EAAE,IAAIA,EAAEC,IAAIC,IAAIR,cAAcW,uBAAuBL,EAAEC,IAAIC,MAAM,OAAO,CAACC,gBAAgB,OAAOH,KAAmYM,EAAE,CAACC,SAAQ,EAAGC,SAAQ,GAAIC,EAAE,IAAIpC,KAAKqC,EAAE,SAAS7C,EAAEC,GAAGJ,IAAIA,EAAEI,EAAEH,EAAEE,EAAED,EAAE,IAAIS,KAAKsC,EAAElB,qBAAqBmB,MAAMA,EAAE,WAAW,GAAGjD,GAAG,GAAGA,EAAEC,EAAE6C,EAAE,CAAC,IAAI3C,EAAE,CAAC+C,UAAU,cAAc9C,KAAKL,EAAEuB,KAAK6B,OAAOpD,EAAEoD,OAAOC,WAAWrD,EAAEqD,WAAWC,UAAUtD,EAAEyC,UAAUc,gBAAgBvD,EAAEyC,UAAUxC,GAAGE,EAAEkB,cAAcrB,GAAGA,EAAEI,MAAMD,EAAE,KAAKqD,EAAE,SAASxD,GAAG,GAAGA,EAAEqD,WAAW,CAAC,IAAIpD,GAAGD,EAAEyC,UAAU,KAAK,IAAI9B,KAAK8C,YAAY7C,OAAOZ,EAAEyC,UAAU,eAAezC,EAAEuB,KAAK,SAASvB,EAAEC,GAAG,IAAIC,EAAE,WAAW8C,EAAEhD,EAAEC,GAAGG,KAAKD,EAAE,WAAWC,KAAKA,EAAE,WAAW2B,oBAAoB,YAAY7B,EAAE0C,GAAGb,oBAAoB,gBAAgB5B,EAAEyC,IAAIhB,iBAAiB,YAAY1B,EAAE0C,GAAGhB,iBAAiB,gBAAgBzB,EAAEyC,GAA9N,CAAkO3C,EAAED,GAAGgD,EAAE/C,EAAED,KAAKiD,EAAE,SAASjD,GAAG,CAAC,YAAY,UAAU,aAAa,eAAeqB,cAAcpB,GAAG,OAAOD,EAAEC,EAAEuD,EAAEZ,OCEr9Ec,EAASC,wBASTC,EARSC,OAAOhC,SAASiC,oCACdJ,sBAOQK,aAAa,iBAChCC,EAAMH,OAAOI,SAASC,KACtBC,EAAmBxD,KAAKC,MACxBwD,EAAuB,GACzBC,GAAW,EAEf,SAASC,EAAaC,GACpBH,EAAUG,EAAO9D,IAAM,CACrBA,GAAI8D,EAAO9D,GACXJ,KAAMkE,EAAOlE,KACbC,MAAOiE,EAAOjE,QDrB23B,SAASN,EAAEC,GAAG,IAAIC,EAAEC,EAAEC,EAAE,MAAM,GAAGqB,EAAE,SAASzB,GAAGA,EAAEwE,iBAAiBrE,EAAEG,OAAON,EAAEM,MAAMH,EAAEK,QAAQiE,KAAKzE,GAAGE,MAAMgC,EAAElB,EAAE,eAAeS,GAAGS,IAAIhC,EAAEkC,EAAEpC,EAAEG,EAAEF,GAAGyB,cAAcQ,EAAEwC,cAAcrD,IAAII,GAAGvB,OAAO8B,cAAc7B,EAAEC,EAAE,MAAM,GAAGF,EAAEkC,EAAEpC,EAAEG,EAAEF,QC6C3lCqE,GAAc,GD7C40C,SAAStE,EAAEC,GAAG,IAAIC,EAAEC,EAAEuC,IAAIjB,EAAErB,EAAE,OAAOsB,EAAEV,EAAE,kBAAkBhB,GAAG,2BAA2BA,EAAEK,OAAOqB,GAAGA,EAAEiD,aAAa3E,EAAEsD,UAAUnD,EAAEsC,YAAYhB,EAAEnB,MAAMN,EAAEsD,UAAU7B,EAAEjB,QAAQiE,KAAKzE,GAAGkC,EAAE0C,IAAInD,GAAGvB,SAASwB,IAAIxB,EAAEkC,EAAEpC,EAAEyB,EAAExB,GAAG+B,YAAY7B,GAAGsB,EAAErB,EAAE,OAAOF,EAAEkC,EAAEpC,EAAEyB,EAAExB,GAAG4E,kCAAkCA,kCAAkCpD,EAAEnB,MAAMmD,YAAY7C,MAAMT,EAAEsC,UAAUP,EAAE0C,IAAInD,GAAGvB,eC8CvsDoE,GAAc,GD9Cq8E,SAASpE,EAAEuB,GAAG,IAAIqD,EAAExC,EAAEI,IAAIH,EAAEnC,EAAE,OAAOoC,EAAE,SAASxC,GAAGA,EAAEsD,UAAUhB,EAAEG,YAAYF,EAAEjC,MAAMN,EAAEuD,gBAAgBvD,EAAEsD,UAAUf,EAAE/B,QAAQiE,KAAKzE,GAAGkC,EAAE0C,IAAIrC,GAAGuC,MAAMC,EAAE/D,EAAE,cAAcwB,GAAGsC,EAAE1C,EAAElC,EAAEqC,EAAEd,GAAGsD,GAAGrD,cAAcqD,EAAEL,cAAcrD,IAAImB,GAAGuC,EAAEJ,gBAAe,GAAII,GAAG/C,cAAc,IAAIhB,EAAEuB,EAAEnC,EAAE,OAAO0E,EAAE1C,EAAElC,EAAEqC,EAAEd,GAAGtB,EAAE,GAAGF,GAAG,EAAED,EAAE,KAAKiD,EAAErB,kBAAkBZ,EAAEwB,EAAErC,EAAEsE,KAAKzD,GAAGkC,QC+CpyFoB,GAAc,GD/CgyF,SAAStE,EAAEC,GAAG,IAAIC,EAAEC,EAAEuC,IAAIjB,EAAErB,EAAE,OAAO0E,EAAE,SAAS9E,GAAG,IAAIC,EAAED,EAAEsD,UAAUrD,EAAEE,EAAEsC,YAAYhB,EAAEnB,MAAML,EAAEwB,EAAEjB,QAAQiE,KAAKzE,IAAIE,KAAKoC,EAAEtB,EAAE,2BAA2B8D,GAAG,GAAGxC,EAAE,CAACpC,EAAEkC,EAAEpC,EAAEyB,EAAExB,GAAG,IAAIsC,EAAE,WAAWL,EAAEG,IAAIZ,KAAKa,EAAEoC,cAAcrD,IAAIyD,GAAGxC,EAAEqC,aAAazC,EAAE0C,IAAInD,GAAGvB,MAAM,CAAC,UAAU,SAASmB,cAAcrB,GAAG4B,iBAAiB5B,EAAEuC,EAAE,CAACyC,MAAK,EAAGlC,SAAQ,OAAQpB,EAAEa,GAAE,GAAIP,YAAY7B,GAAGsB,EAAErB,EAAE,OAAOF,EAAEkC,EAAEpC,EAAEyB,EAAExB,GAAG4E,kCAAkCA,kCAAkCpD,EAAEnB,MAAMmD,YAAY7C,MAAMT,EAAEsC,UAAUP,EAAE0C,IAAInD,GAAGvB,eCgD5xGoE,GAAc,GDhD+xG,SAAStE,GAAG,IAAIC,EAAEC,EAAEE,EAAE,QAAQH,EAAE,WAAW,IAAI,IAAIA,EAAEwD,YAAYwB,iBAAiB,cAAc,IAAI,WAAW,IAAIjF,EAAEyD,YAAYyB,OAAOjF,EAAE,CAACkD,UAAU,aAAaG,UAAU,GAAG,IAAI,IAAIpD,KAAKF,EAAE,oBAAoBE,GAAG,WAAWA,IAAID,EAAEC,GAAGW,KAAKsE,IAAInF,EAAEE,GAAGF,EAAEoF,gBAAgB,IAAI,OAAOnF,EAAhL,GAAqLC,EAAEI,MAAMJ,EAAEK,MAAMN,EAAEoF,cAAcnF,EAAEM,QAAQ,CAACP,GAAGD,EAAEE,GAAG,MAAMF,MAAM,aAAa6B,SAASyD,WAAW3C,WAAW1C,EAAE,GAAG2B,iBAAiB,WAAW3B,ICiDjtHqE,GAElBT,OAAOjC,iBAAiB,YA1BxB,eACMyC,GACJA,GAAW,MACLkB,EAAuB,CAC3B3B,SAAAA,EACA4B,QAASC,OAAOC,OAAOtB,GACvBJ,IAAAA,EACA2B,SAAUhF,KAAKC,MAAQuD,GAEnByB,YAAgBlC,0BAAsBE,GACtCiC,EAAiBC,KAAKC,UAAUR,MAClCS,UAAUC,kBACLD,UAAUC,WAAWL,EAAYC,OAEpCK,EAAM,IAAIC,eACdD,EAAIE,KAAK,OAAQR,GACjBM,EAAIG,KAAKR"}